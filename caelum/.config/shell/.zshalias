# Initialize zoxide

eval "$(zoxide init zsh)"

# Environment variables

export LD_LIBRARY_PATH="/usr/local/lib:/usr/local/lib64/"
export PATH="$HOME/.local/bin:$PATH"
export GIT="[https://github.com](https://github.com)"
export PROJECTS="$HOME/Projects/"
export SCRIPTS="$HOME/.scripts"
export WALLP="$HOME/.wallpapers"
export CONFIG="$HOME/.config"

# System aliases

alias remove="sudo pacman -R"

alias cd='z'
alias ls="eza --icons --all"
alias ll="eza --icons --color --long --tree --all"
alias nv="nvim"

alias kill="killall -KILL"
alias copy="wl-copy"
alias syncv="rclone sync $HOME/Vault gdrive:Vault/"

# VPN aliases

alias vpnc="sudo protonvpn c"
alias vpnd="sudo protonvpn d"
alias vpns="sudo protonvpn status"

# Script aliases

alias py="python"
alias fontinstall="cp $SCRIPTS/fontin.py ./ && python3 ./fontin.py && rm fontin.py"
alias port_foward="$SCRIPTS/portfowarding.sh"
alias audio="/usr/bin/audio -c wp"
alias icat="kitty +kitten icat"
alias fasty="fastfetch"

# Git helper function with fuzzy subcommands and autocompletion

g() {
local cmd="$1"
shift
case "$cmd" in
init* ) git init "$@" ;;
cl* ) git clone "$@" ;;
co* ) git checkout "$@" ;;
b ) git branch "$@" ;;
bd ) git branch -d "$@" ;;
st* ) git status "$@" ;;
a ) git add "$@" ;;
aa ) git add . ;;
cm* ) git commit -m "$@" ;;
p | push ) git push "$@" ;;
pl* ) git pull "$@" ;;
pr )
branch=$(git rev-parse --abbrev-ref HEAD)
git push --set-upstream origin "$branch" && 
echo "Pull request created for branch $branch"
;;
rh* ) git reset --hard ;;
d* ) git diff "$@" ;;
lg* ) lazygit ;;
* ) echo "Usage: g [init|cl|co|b|bd|st|a|aa|cm|p|pl|pr|rh|d|lg]" ;;
esac
}

# Enable git autocomplete for g()

compdef _git g

# -- some funcs cause yes

inst() {
  if [ "$#" -eq 0 ]; then
    echo "Usage: inst <package> [package...]"
    return 1
  fi

  local repo=()
  local aur=()

  for pkg in "$@"; do
    if pacman -Si "$pkg" &>/dev/null; then
      repo+=("$pkg")
    else
      aur+=("$pkg")
    fi
  done

  if [ "${#repo[@]}" -gt 0 ]; then
    sudo pacman -S "${repo[@]}" --noconfirm
  fi

  if [ "${#aur[@]}" -gt 0 ]; then
    yay -S "${aur[@]}" --noconfirm
  fi
}

update() {
    echo "Updating all packages..."
    sudo pacman -Syu --noconfirm
    yay -Syu --noconfirm
}

# Custom completion that only suggests package names
if [ -n "$BASH_VERSION" ]; then
    _install_complete() {
        local cur="${COMP_WORDS[COMP_CWORD]}"
        COMPREPLY=( $(compgen -W "$(pacman -Sql)" -- "$cur") )
    }
    complete -F _install_complete inst 
elif [ -n "$ZSH_VERSION" ]; then
    _install_zsh() {
        local -a packages
        packages=(${(f)"$(pacman -Sql)"})
        _describe 'package' packages
    }
    compdef _install_zsh inst 
fi


print_welcome() {
  local t u k
  t=$(LC_TIME=C date +"%I:%M%p" | tr '[:upper:]' '[:lower:]')
  u=$(uptime -p | sed 's/^up //')
  k=$(uname -r)
  print -P "\nit's %F{39}$t%f  %F{75}$u%f  %F{250}$k%f\n"
}
[[ -z "$ZSH_WELCOME_SHOWN" ]] && print_welcome && export ZSH_WELCOME_SHOWN=1

